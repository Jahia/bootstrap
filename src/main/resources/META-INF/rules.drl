package org.jahia.modules.bootstrap.rules

// list any import classes here.
import org.jahia.services.content.rules.*
import org.jahia.services.content.JCRContentUtils
import org.slf4j.Logger

expander rules.dsl

// declare any global variables here
global User user
global Service service
global Logger logger
global JCRContentUtils jcrUtils
global BootstrapCompilerRuleService bootstrapCompiler

rule "Set less folder ACL"
  when
    A new node is created
      - the node has the type jnt:folder
      - its path matches /sites/[\\p{Alnum}\\-_]+/files/less
  then
    Break all ACL inheritance on the node
    Grant role editor on the node to the group site-administrators
end

rule "Set bootstrap folder ACL"
  when
    A new node is created
      - the node has the type jnt:folder
      - its path matches /sites/[\\p{Alnum}\\-_]+/files/bootstrap
  then
    Break all ACL inheritance on the node
    Grant role editor on the node to the group site-administrators
    Grant role reader on the node to the group users
    Grant role reader on the node to the user guest
    Grant role privileged on the node to the group privileged
end

rule "Compile Bootstrap"
  when
    A file content has been modified
      - its path matches /sites/[\\p{Alnum}\\-_]+/files/less/[\\p{Alnum}\\-_]+.less
    The node has not been copied
    The node has a parent
  then
    Compile the parent to css
end
